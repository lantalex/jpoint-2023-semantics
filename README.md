# –ù–µ happens-before –µ–¥–∏–Ω—ã–º: –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å–µ–º–∞–Ω—Ç–∏–∫–∏

–ü—Ä–∏–º–µ—Ä—ã –¥–ª—è [–¥–æ–∫–ª–∞–¥–∞ –Ω–∞ JPoint 2023](https://jpoint.ru/talks/3c298184b4c2467d94d48ff9d135bb59/)

> –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ –Ω–æ–≤—ã–µ —Ä–µ–∂–∏–º—ã —É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–≤ –∫ –ø–∞–º—è—Ç–∏ —Å—Ç–∞–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –µ—â–µ —Å –≤—ã—Ö–æ–¥–æ–º JDK 9, –Ω–µ–º–Ω–æ–≥–∏–µ
> —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–Ω–∞–∫–æ–º—ã —Å –Ω–∏–º–∏. –•–æ—Ç—è —ç—Ç–∏ —Å–µ–º–∞–Ω—Ç–∏–∫–∏ –≤—Å–µ –µ—â–µ –Ω–µ –∏–º–µ—é—Ç —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –≤ –º–æ–¥–µ–ª–∏ –ø–∞–º—è—Ç–∏ Java, –æ–Ω–∏ —à–∏—Ä–æ–∫–æ
> –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö: JCTools, Disruptor, Agrona, Aeron –∏ –º–Ω–æ–≥–∏—Ö –¥—Ä—É–≥–∏—Ö. –ü–æ—ç—Ç–æ–º—É –¥–ª—è
> –∏–∑—É—á–µ–Ω–∏—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ —ç—Ç–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –Ω—É–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–µ–∂–∏–º—ã —É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏—è.
>
> –ù–æ –¥–∞–∂–µ –¥–ª—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —ç—Ç–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å–≤–æ–π—Å—Ç–≤ —ç—Ç–∏—Ö —Ä–µ–∂–∏–º–æ–≤
> –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç—å –∫ –≤—ã–±–æ—Ä—É –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö. –í—Å–µ —ç—Ç–æ –º–æ–∂–µ—Ç
> —É–≤–µ–ª–∏—á–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã.
>
> –í –¥–æ–∫–ª–∞–¥–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Ä–µ–∂–∏–º—ã: _plain_, _opaque_, _acquire-release_,
_volatile_. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–∫–∞–∑–∞–Ω—ã –µ–≥–æ –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –∏ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
>
>–î–æ–∫–ª–∞–¥ –±—É–¥–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å–µ–Ω –≤—Å–µ–º, –∫—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç—Å—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º, –º–æ–¥–µ–ª—è–º–∏ –ø–∞–º—è—Ç–∏ –∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã–º–∏ lock-free
> –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏.

## –í–∏–¥–µ–æ

[![—Å—Å—ã–ª–∫–∞ –Ω–∞ youtube](https://img.youtube.com/vi/UZbPOtEgcoY/0.jpg)](https://www.youtube.com/watch?v=UZbPOtEgcoY)


## –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è

–°–º. –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ [–¥–æ–∫–ª–∞–¥–∞](https://jpoint.ru/talks/3c298184b4c2467d94d48ff9d135bb59/)

## –ü—Ä–∏–º–µ—Ä—ã

|   –ù–æ–º–µ—Ä–∞ —Å–ª–∞–π–¥–æ–≤   | –§–∞–π–ª                                                                                                                                                                                                                                                                                       | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                                                                                                                                                                                                                                                                                                                     |
|:------------------:|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 19-26,<br/>134-137 | [`VolatileSemantic_HappensBefore.java`](./src/jcstress/java/io/github/lantalex/VolatileSemantic_HappensBefore.java)                                                                                                                                                                        | –£–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ _happens-before_                                                                                                                                                                                                                                                                                    |
|       53-64        | [`PlainSemantic.java`](./src/jcstress/java/io/github/lantalex/PlainSemantic.java)                                                                                                                                                                                                          | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ _plain_-—Å–µ–º–∞–Ω—Ç–∏–∫–∏, –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª                                                                                                                                                                                                                                                                                  |
|       74-94        | [`VarHandleApi.java`](./src/main/java/io/github/lantalex/VarHandleApi.java)                                                                                                                                                                                                                | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ```VarHandle``` –≤ —Å–≤–æ—ë–º –∫–æ–¥–µ                                                                                                                                                                                                                                                                                                      |
|      101-107       | [`OpaqueSemantic_Progress.java`](./src/jcstress/java/io/github/lantalex/OpaqueSemantic_Progress.java)                                                                                                                                                                                      | –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ **–ø—Ä–æ–≥—Ä–µ—Å—Å–∞** –¥–ª—è _opaque_-—Å–µ–º–∞–Ω—Ç–∏–∫–∏                                                                                                                                                                                                                                                                                      |
|      110-120       | [`OpaqueSemantic_Coherence.java`](./src/jcstress/java/io/github/lantalex/OpaqueSemantic_Coherence.java)                                                                                                                                                                                    | –ü–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ _opaque_-—Å–µ–º–∞–Ω—Ç–∏–∫–∏                                                                                                                                                                                                                                                   |
|      125-129       | [`OpaqueSemantic_BitwiseAtomicity.java`](./src/jcstress/java/io/github/lantalex/OpaqueSemantic_BitwiseAtomicity.java)                                                                                                                                                                      | –ì–∞—Ä–∞–Ω—Ç–∏—è **–∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏** –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ –≤ _opaque_-—Å–µ–º–∞–Ω—Ç–∏–∫–µ                                                                                                                                                                                                                                                                            |
|      138-152       | [`AcquireReleaseSemantic_Causality.java`](./src/jcstress/java/io/github/lantalex/AcquireReleaseSemantic_Causality.java)                                                                                                                                                                    | –£–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ –≥–∞—Ä–∞–Ω—Ç–∏—é **–ø—Ä–∏—á–∏–Ω–Ω–æ—Å—Ç–∏** —Å –ø–æ–º–æ—â—å—é _acquire-release_ —Å–µ–º–∞–Ω—Ç–∏–∫–∏                                                                                                                                                                                                                                      |
|      161-172       | [`SPSC_BoundedQueue.java`](./src/main/java/io/github/lantalex/queue/SPSC_BoundedQueue.java)<br/>[`SPSC_VolatileQueue.java`](./src/main/java/io/github/lantalex/queue/SPSC_VolatileQueue.java)<br>[`SPSC_AcqRelQueue.java`](./src/main/java/io/github/lantalex/queue/SPSC_AcqRelQueue.java) | –ü—Ä–æ—Å—Ç–µ–π—à–∞—è –æ—á–µ—Ä–µ–¥—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –¥–ª—è —Å—Ç—Ä–æ–≥–æ –æ–¥–Ω–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –∏ —Å—Ç—Ä–æ–≥–æ –æ–¥–Ω–æ–≥–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è: `SPSC_BoundedQueue`. –î–≤–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —ç—Ç–æ–π –æ—á–µ—Ä–µ–¥–∏, —á–µ—Ä–µ–∑ _volatile_-—Å–µ–º–∞–Ω—Ç–∏–∫—É: `SPSC_VolatileQueue`, –∏  —á–µ—Ä–µ–∑ _acquire-release_-—Å–µ–º–∞–Ω—Ç–∏–∫—É: `SPSC_AcqRelQueue`                                                                             |
|      173-176       | [`QueueBenchmark.java`](./src/jmh/java/io/github/lantalex/QueueBenchmark.java)                                                                                                                                                                                                             | –ë–µ–Ω—á–º–∞—Ä–∫, –∏–∑–º–µ—Ä—è—é—â–∏–π –ø—Ä–æ–ø—É—Å–∫–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö SPSC-–æ—á–µ—Ä–µ–¥–µ–π                                                                                                                                                                                                                                                                         |
|      180-187       | [```VolatileSemantic_Consensus.java```](./src/jcstress/java/io/github/lantalex/VolatileSemantic_Consensus.java)                                                                                                                                                                            | –°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ ü¶ä–∫—Ä–∞—Å–Ω–æ–π –ø–∞–Ω–¥—ã –∏ üê±–∫–æ—Ç–∞: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏ **–∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞** —Å –ø–æ–º–æ—â—å—é _volatile_-—Å–µ–º–∞–Ω—Ç–∏–∫–∏                                                                                                                                                                                                                                     |
|      189-197       | [`AcquireReleaseSemantic_NoConsensus.java`](./src/jcstress/java/io/github/lantalex/AcquireReleaseSemantic_NoConsensus.java)                                                                                                                                                                | –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç –≤ –∏—Ç–æ–≥–∞—Ö —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ _acquire-release_ —Å–µ–º–∞–Ω—Ç–∏–∫–∏.<br/>–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–æ–º –º–Ω–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è, –Ω–æ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —Å–ª—É—á–∏—Ç—Å—è –Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ `PowerPC`                                                                                                                       |
|        199         | [`AcquireReleaseSemantic_NoConsensus_Dekker.java`](./src/jcstress/java/io/github/lantalex/AcquireReleaseSemantic_NoConsensus_Dekker.java)<br/>[`VolatileSemantic_Consensus_Dekker.java`](./src/jcstress/java/io/github/lantalex/VolatileSemantic_Consensus_Dekker.java)                    | –í–∏–¥–æ–∏–∑–º–µ–Ω–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä, —Ç–µ–ø–µ—Ä—å –ª–æ–≥–∏–∫–∞ `Referee#1` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–æ—Ç–æ–∫–µ üê±`Cat`, –ª–æ–≥–∏–∫–∞ `Referee#2` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–æ—Ç–æ–∫–µ ü¶ä`Red Panda`; –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —á–µ–≥–æ –≤–æ–∑–º–æ–∂–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç –¥–ª—è _acquire-release_ —Å–µ–º–∞–Ω—Ç–∏–∫–∏; –¥–ª—è _volatile_-—Å–µ–º–∞–Ω—Ç–∏–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç –≤–≤–∏–¥—É –≥–∞—Ä–∞–Ω—Ç–∏–∏ **–∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞** –Ω–µ –≤–æ–∑–º–æ–∂–µ–Ω                                                              |
|                    | [`Barriers_NoConsensus_Dekker.java`](./src/jcstress/java/io/github/lantalex/Barriers_NoConsensus_Dekker.java)                                                                                                                                                                              | –ö–æ–Ω—Ç—Ä–ø—Ä–∏–º–µ—Ä –¥–ª—è –ª–µ–∫—Ü–∏–∏   [–ú–∞–≥–∏—Å—Ç–µ—Ä—Å–∫–∏–π –∫—É—Ä—Å C++ (–ú–§–¢–ò, 2022-2023). –õ–µ–∫—Ü–∏—è 21. –ê—Ç–æ–º–∏–∫–∏, —á–∞—Å—Ç—å 3](https://youtu.be/Y1q_Z2T2UcE?feature=shared&t=1928), —Å–ª–∞–π–¥ 107: "–Ø–≤–Ω—ã–µ –±–∞—Ä—å–µ—Ä—ã —Å–ø–µ—à–∞—Ç –Ω–∞ –ø–æ–º–æ—â—å" - –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å —Å–µ–º–∞–Ω—Ç–∏–∫ _opaque_ –∏ _acquire-release_ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –î–µ–∫–∫–µ—Ä–∞                                                       |
|                    | [`Single_Variable_Coherence.java`](./src/jcstress/java/io/github/lantalex/Single_Variable_Coherence.java)                                                                                                                                                                                  | –ö–æ–Ω—Ç—Ä–ø—Ä–∏–º–µ—Ä –¥–ª—è –ª–µ–∫—Ü–∏–∏   [–ú–∞–≥–∏—Å—Ç–µ—Ä—Å–∫–∏–π –∫—É—Ä—Å C++ (–ú–§–¢–ò, 2022-2023). –õ–µ–∫—Ü–∏—è 21. –ê—Ç–æ–º–∏–∫–∏, —á–∞—Å—Ç—å 3](https://youtu.be/Y1q_Z2T2UcE?feature=shared&t=2763), —Å–ª–∞–π–¥ 116: "–¢–µ–æ—Ä–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏", –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ—è–≤–ª–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è —Å—Ç—Ä–æ–≥–æ –æ–¥–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤–≤–∏–¥—É –Ω–∞–ª–∏—á–∏—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –∫–æ–≥–µ—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏–∫ –æ—Ç _opaque_ –∏ —Å–∏–ª—å–Ω–µ–µ |

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å —Å–ª–µ–¥—É—é—â–µ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ:

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ x86-64

#### –û—Å–Ω–æ–≤–Ω–∞—è –º–∞—à–∏–Ω–∞

> **CPU**: Intel Core i9 12900K (—ç–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —è–¥—Ä–∞ –æ—Ç–∫–ª—é—á–µ–Ω—ã)  
> **RAM**: 32GB DDR5-4800 MHz   
> **JVM**: 17.0.6+10-LTS  
> **OS**: Ubuntu 22.04.2 LTS/Linux 5.15.0-69-generic

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ARM

#### ARMv8 - Raspberry Pi 4 Model B

> **CPU**: Broadcom BCM2711  
> **RAM**: 8GB LPDDR4-1500 MHz  
> **JVM**: 17.0.6+10-LTS  
> **OS**: Ubuntu 22.04.2 LTS/Linux 5.15.0-1026-raspi/arm64

#### ARMv7 - Raspberry Pi 2

> **CPU**: Broadcom BCM2836  
> **RAM**: 1GB LPDDR2-400 MHz  
> **JVM**: 17.0.6+10-LTS  
> **OS**: Raspbian GNU/Linux 5.15.84-v7+/arm